!function(e,t){"use strict";var s={childCheck:!1,parentCheck:!1,allChecked:new Object,industriesRequired:!1,industriesOnly:!1,maxIndustriesCount:0,industriesSelectAll:!1,categoriesSelectedById:!1,selectCount:0,main:"",input_suffix:""};function l(t,l){this.element=t,this.options=e.extend({},s,l),this.init()}l.prototype.init=function(){var t=this,s=e(t.element);t.options.$selectInputs=s.find(".js-multiple-epselect-inputs"),t.options.$selectListWr=s.find(".multiple-epselect__list-wr"),t.options.$selectList=s.find(".multiple-epselect__list"),t.options.$selectInput=s.find(".multiple-epselect__input"),t.options.$selectTop=s.find(".multiple-epselect__top"),t.options.$selectInner=s.find(".multiple-epselect__inner"),t.options.$selectAllParents=s.find(".multiple-epselect__parent:not(.multiple-epselect__parent--all)"),t.options.$selectAllParentsData=s.find(".multiple-epselect__parent[data-industry]"),t.reInitOptions(),t.options.industriesSelectAll&&(t.options.$selectAll=s.find(".js-multiple-epselect-all"),t.selectAllInit()),t.initPlug(),t.initListiners()},l.prototype.reInitOptions=function(){var e=this;e.options.allChecked=new Object(e.options.selected_cat_json),e.options.industriesRequired=Boolean(~~parseInt(e.options.industries_required,10)),e.options.industriesOnly=Boolean(~~parseInt(e.options.industries_only,10)),e.options.maxIndustriesCount=parseInt(e.options.max_industries,10),e.options.industriesSelectAll=Boolean(~~parseInt(e.options.industries_select_all,10)),e.options.categoriesSelectedById=Boolean(~~parseInt(e.options.categories_selected_by_id,10)),e.options.selectCount=parseInt(e.options.industries_selected,10),e.options.main=e.options.widget_id,e.options.inputSuffix=e.options.input_suffix},l.prototype.initPlug=function(){var e=this;e.generateInputs(),e.options.industriesRequired&&e.setValidateMultipleEpselect()},l.prototype.initListiners=function(){var t=this,s=e(t.element);s.on("click",".js-call-check-industry:not(.disabled)",function(s){s.preventDefault();var l=e(this);t.callCheckIndustry(l)}),s.on("click",".js-call-check-category:not(.disabled)",function(s){s.preventDefault();var l=e(this);t.callCheckCategory(l)}),s.on("click",".js-call-multiple-toggle-categories:not(.disabled)",function(s){s.preventDefault();var l=e(this);t.multipleToggleCategories(l)}),s.on("click",".js-call-multiple-select-all-industries:not(.disabled)",function(s){s.preventDefault();var l=e(this);t.multipleSelectAllIndustries(l)}),e("body").on("click",function(l){var n=s;e(l.target)[0]!==n[0]&&e(l.target).parents(".multiple-epselect")[0]!==n[0]&&(e(l.target)[0]!==t.options.$selectListWr[0]&&e(l.target).parents(".multiple-epselect__list-wr")[0]===t.options.$selectListWr[0]||!t.options.$selectListWr.is(":visible")||t.options.$selectListWr.hide())}),t.options.$selectInput.on("click",function(t){e(this).next(".multiple-epselect__list-wr").toggle()})},l.prototype.generateInputs=function(){var e=this,t="";Object.keys(e.options.allChecked).map(function(s,l){var n=e.options.allChecked[s];t+='<input type="hidden" name="industriesSelected'+e.options.inputSuffix+'[]" value="'+s+'">',Object.keys(n).length>0&&Object.keys(n).map(function(s,l){t+='<input type="hidden" name="categoriesSelected'+e.options.inputSuffix+'[]" value="'+s+'">'})}),e.options.$selectInputs.html(t),e.validateMultipleEpselect()},l.prototype.setValidateMultipleEpselect=function(t){var s=this,l=e(s.element),n="multipleIndustryEpselect"+s.options.widget_id;l.addClass("validate[required]").setValHookType(n),e.valHooks[n]={get:function(e){return s.options.$selectInputs.find("input[type=hidden]").length||[]}}},l.prototype.validateMultipleEpselect=function(e){this.options.$selectInput.hasClass("validengine-border")&&this.options.$selectInput.removeClass("validengine-border").prev(".formError").remove()},l.prototype.multipleToggleCategories=function(e){var t=e.closest(".multiple-epselect__parent"),s=t.data("industry"),l=t.find(".multiple-epselect__inner");l.find("li").length?(t.find(".multiple-epselect__toggle").toggleClass("ep-icon_plus-stroke ep-icon_remove-stroke"),l.slideToggle()):this.multipleLoadCategories(t,s)},l.prototype.multipleLoadCategories=function(t,s){var l=this;if(l.options.industriesOnly||t.hasClass("nochildrens"))return!0;e.ajax({type:"POST",url:"directory/ajax_company_category_new",dataType:"json",data:{industry:s},beforeSend:function(){showLoader(t.closest(".multiple-epselect__list-wr"),"Loading...")},success:function(s){if(hideLoader(t.closest(".multiple-epselect__list-wr"),"Loading..."),"success"==s.mess_type)if(s.categories.length){var n="";e.each(s.categories,function(e,t){n+='<li>                                    <label                                        class="js-call-check-category"                                        data-callback="callCheckCategory"                                        data-category="'+t.category_id+'"                                    >                                        <span class="pseudo-checkbox"></span>                                        <span class="name">'+t.name+"</span>                                    </label>                                </li>"}),t.find(".multiple-epselect__inner").html(n).slideToggle().end().find(".multiple-epselect__toggle").toggleClass("ep-icon_plus-stroke ep-icon_remove-stroke"),t.find(".multiple-epselect__counted").length||t.find(".multiple-epselect__top label").append('<div class="multiple-epselect__counted"> '+l.options.translate_multiple_select_selected_categories+' <span class="js-count-cat-selected">0</span>/'+s.categories_count+"</div>")}else t.addClass("nochildrens"),systemMessages(translate_js({plug:"general_i18n",text:"multiple_select_industry_without_categories_msg"}),"info");else systemMessages(s.message,s.mess_type)}})},l.prototype.multipleSelectAllIndustries=function(t){var s=this,l=t.find(".pseudo-checkbox");l.hasClass("checked")?(l.removeClass("checked"),s.options.allChecked=new Object,s.options.$selectAllParentsData.each(function(){var t=e(this),s=t.find(".pseudo-checkbox.checked");parseInt(t.data("industry"));s.length&&s.removeClass("checked")})):(l.addClass("checked"),s.options.$selectAllParentsData.each(function(){var t=e(this),l=t.find(".pseudo-checkbox"),n=parseInt(t.data("industry"));return!!l.hasClass("disabled")||(!!l.hasClass("checked")||(l.addClass("checked"),void(s.options.allChecked[n]=new Object)))})),s.countAllSelected(),s.generateInputs()},l.prototype.callCheckIndustry=function(e){var t=this,s=e.closest(".multiple-epselect__parent").data("industry");if(t.verifyMaxIndustries(s))return!1;null==t.options.allChecked[s]?(e.find(".pseudo-checkbox").addClass("checked"),t.options.allChecked[s]=new Object):(e.find(".pseudo-checkbox").removeClass("checked"),delete t.options.allChecked[s]),t.options.industriesSelectAll&&t.selectAllInit(),t.countAllSelected(),t.generateInputs()},l.prototype.callCheckCategory=function(e){var t=this,s=e.closest(".multiple-epselect__parent"),l=s.data("industry"),n=e.data("category");if(t.verifyMaxIndustriesByCategories(l))return!1;null==t.options.allChecked[l]&&(t.options.allChecked[l]=new Object),null==t.options.allChecked[l][n]?(e.find(".pseudo-checkbox").addClass("checked"),t.options.allChecked[l][n]=n):(e.find(".pseudo-checkbox").removeClass("checked"),delete t.options.allChecked[l][n],0==Object.keys(t.options.allChecked[l]).length&&delete t.options.allChecked[l]),t.countSelected(s,l),t.countAllSelected(),t.generateInputs()},l.prototype.countAllSelected=function(e){var t=this,s=Object.keys(t.options.allChecked).length,l=0;if(Object.keys(t.options.allChecked).map(function(e,s){var n=t.options.allChecked[e];l+=Object.keys(n).length}),t.options.industriesOnly)t.options.$selectInput.text(translate_js({plug:"general_i18n",text:"multiple_select_count_selected_industries_placeholder",replaces:{"{{COUNT}}":s}}));else{var n="multiple_select_select_industries_and_categories_count_placeholder";1===s&&1!==l&&(n="multiple_select_select_industry_and_categories_count_placeholder"),1===s&&1===l&&(n="multiple_select_select_industry_and_category_count_placeholder"),t.options.$selectInput.text(translate_js({plug:"general_i18n",text:n,replaces:{"{{COUNT_C}}":l,"{{COUNT_I}}":s}}))}},l.prototype.verifyMaxIndustries=function(e){var t=this,s=Object.keys(t.options.allChecked).length;return null==t.options.allChecked[e]&&t.options.maxIndustriesCount>0&&s==t.options.maxIndustriesCount&&(systemMessages(translate_js({plug:"general_i18n",text:"multiple_select_max_industries",replaces:{"[COUNT]":t.options.maxIndustriesCount}}),"warning"),!0)},l.prototype.verifyMaxIndustriesByCategories=function(e){var t=this,s=Object.keys(t.options.allChecked).length;return null==t.options.allChecked[e]&&t.options.maxIndustriesCount>0&&s==t.options.maxIndustriesCount&&(systemMessages(translate_js({plug:"general_i18n",text:"multiple_select_max_industries_by_categories",replaces:{"[COUNT]":t.options.maxIndustriesCount}}),"warning"),!0)},l.prototype.selectAllInit=function(t){var s=this,l=0;s.options.$selectAllParents.each(function(){var t=e(this).find(".pseudo-checkbox");return!!t.hasClass("disabled")||(!!t.hasClass("checked")||void l++)}),0==l?s.options.$selectAll.find(".pseudo-checkbox").addClass("checked"):s.options.$selectAll.find(".pseudo-checkbox").removeClass("checked")},l.prototype.countSelected=function(e,t){var s=0;null!=this.options.allChecked[t]&&(s=Object.keys(this.options.allChecked[t]).length),e.find(".multiple-epselect__top .js-count-cat-selected").text(s),s>0&&!e.hasClass("checked")?e.addClass("checked"):0==s&&e.hasClass("checked")&&e.removeClass("checked")},e.fn.extend({multipleEpSelect:function(t){return this.each(function(){e.data(this,"multipleEpSelect")||e.data(this,"multipleEpSelect",new l(this,t))})}})}(jQuery);
