tinymce.PluginManager.add("remote_preview",function(e){var t=e.settings,n=!tinymce.Env.ie,i=e.settings.remote_preview_url||null,r=e.settings.remote_preview_data||{},o=e.settings.remote_preview_map_to||null,a=e.settings.remote_preview_debug||!1,c=c||tinymce.util.Promise
e.addCommand("mceRemotePreview",function(){null!==i?e.windowManager.open({title:"Preview",width:parseInt(e.getParam("remote_preview_width","650"),10),height:parseInt(e.getParam("remote_preview_height","500"),10),html:'<iframe src="javascript:\'\'" frameborder="0"'+(n?' sandbox="allow-scripts"':"")+"></iframe>",buttons:{text:"Close",onclick:function(){this.parent().parent().close()}},onPostRender:function(){var d=this,s=Object.assign({},r,{content:e.getContent()});(function(e,t){return t=t||{},new c(function(n,i){if("jQuery"in window)jQuery.post(e,t).done(function(e){return n(null!==o?o(e):e)}).fail(function(e){a&&console.error(e),i(Error("Failed to load preview"))})
else{var r=new FormData
for(var c in t)t.hasOwnProperty(c)&&r.append(c,t[c])
tinymce.util.XHR.send({url:e,data:r,success:function(e,t){null!==o&&n(o(e,t)),n(""+e||"")},error:function(){i(Error("Failed to load preview"))}})}})})(i,s).then(function(i){var r,o=""
o+='<base href="'+e.documentBaseURI.getURI()+'">',tinymce.each(e.contentCSS,function(t){o+='<link type="text/css" rel="stylesheet" href="'+e.documentBaseURI.toAbsolute(t)+'">'})
var a=t.body_id||"tinymce";-1!=a.indexOf("=")&&(a=(a=e.getParam("body_id","","hash"))[e.id]||a)
var c=t.body_class||"";-1!=c.indexOf("=")&&(c=(c=e.getParam("body_class","","hash"))[e.id]||"")
var s=e.settings.directionality?' dir="'+e.settings.directionality+'"':""
if(r="<!DOCTYPE html><html><head>"+o+'</head><body id="'+a+'" class="mce-content-body '+c+'"'+s+">"+i+'<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A") {e.preventDefault();}}}, false);</script> </body></html>',n)d.getEl("body").firstChild.src="data:text/html;charset=utf-8,"+encodeURIComponent(r)
else{var l=d.getEl("body").firstChild.contentWindow.document
l.open(),l.write(r),l.close()}})["catch"](function(e){a&&console.error(e),tinymce.activeEditor.notificationManager.open({text:"Failed to load preview",type:"error"})})}}):tinymce.activeEditor.notificationManager.open({text:"You must specify URL that provides HTML contents",type:"error"})}),e.addButton("remote_preview",{title:"Preview",cmd:"mceRemotePreview"}),e.addMenuItem("remote_preview",{text:"Preview",cmd:"mceRemotePreview",context:"view"})})
